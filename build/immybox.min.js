/*!
 * Immybox.js Version 1.0.0-beta3
 * 
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,t,i){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var i=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t){"use strict";function i(e,t){if(!e)throw new Error(t)}function n(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function r(e,t){n(e,t)||(e.className+=" "+t)}function o(e,t){if(n(e,t)){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i," ")}}function s(e,t){return e.parentNode&&e.parentNode.matches?e.parentNode.matches(t)?e.parentNode:s(e.parentNode,t):null}function l(e,t){return e.matches&&e.matches(t)?e:s(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.assert=i,t.hasClass=n,t.addClass=r,t.removeClass=o,t.nodeOrParentMatchingSelector=l,Number.isNaN=Number.isNaN||function(e){return"number"==typeof e&&isNaN(e)},Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),n=i.length>>>0,r=arguments[1],o=0;o<n;o++)if(t=i[o],e.call(r,t,o,i))return t}),Array.prototype.includes||(Array.prototype.includes=function(e){var t=Object(this),i=parseInt(t.length)||0;if(0===i)return!1;var n,r=parseInt(arguments[1])||0;r>=0?n=r:(n=i+r,n<0&&(n=0));for(var o;n<i;){if(o=t[n],e===o||e!==e&&o!==o)return!0;n++}return!1})},function(e,t){function i(e){return null!=e&&"object"==typeof e&&e["@@functional/placeholder"]===!0}e.exports=i},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){m(e),g(t)}function l(e,t,i,n){n.has(i)||n.set(i,new Map),n.get(i).set(e,t),i.addEventListener(e,t)}function u(e){var t=new Map;return p.set(e,t),t}Object.defineProperty(t,"__esModule",{value:!0}),t.ImmyBox=void 0;var a=i(4),c=n(a),h=function(){function e(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(u){r=!0,o=u}finally{try{!n&&l["return"]&&l["return"]()}finally{if(r)throw o}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),f=i(0),p=new Map,v=new Map,y="immybox",m=function(e){return(0,f.removeClass)(e,"active")},g=function(e){return(0,f.addClass)(e,"active")},C=(0,c["default"])(m),w="undefined"!=typeof Event?function(e,t){e.dispatchEvent(new Event(t))}:function(){},A={choices:[],maxResults:50,showArrow:!0,open_on_focus:!0,defaultSelectedValue:void 0,scroll_behavior:"smooth",no_results_text:"no matches",makeQueryResultsText:function(e,t){return"showing "+e+" of "+t},filterFn:function(e){var t=e.toLowerCase();return function(e){return e.text.toLowerCase().indexOf(t)>=0}},formatChoice:function(e){if(e){var t=new RegExp(e.replace(/[#-.]|[[-^]|[?|{}]/g,"\\$&"),"gi");return function(e){return e.text.replace(t,'<span class="highlight">$&</span>')}}return function(e){return e.text}}},x=Object.assign({},A),b=t.ImmyBox=function(){function e(t,i){var n=this;o(this,e),(0,f.addClass)(t,y),t.setAttribute("autocomplete","off");var s=u(this);this.element=t,this.options=Object.assign({},e.defaults,i),this.choices=this.options.choices,"undefined"!=typeof this.options.defaultSelectedValue&&(this.choices=[this.choices.find(function(e){var t=e.value;return t===n.options.defaultSelectedValue})].concat(r(this.choices.filter(function(e){var t=e.value;return t!==n.options.defaultSelectedValue}))).filter(function(e){return e})),this.indexed_choices=this.choices.map(function(e,t){return{index:t,choice:e}}),this.selectedChoice=null,this.scroll_position=null,this.options.showArrow&&(0,f.addClass)(this.element,y+"_witharrow"),this.selectChoiceByValue(this.element.value),this.dropdownArea=document.createElement("div"),(0,f.addClass)(this.dropdownArea,y+"_dropdown"),this.dropdownAreaVisible=!1,this.queryResultArea=document.createElement("div"),(0,f.addClass)(this.queryResultArea,y+"_results"),this.noResultsArea=document.createElement("p"),(0,f.addClass)(this.noResultsArea,y+"_noresults"),this.noResultsArea.textContent=this.options.no_results_text||x.no_results_text,this.options.makeQueryResultsText&&("function"==typeof this.options.makeQueryResultsText?this.results_text_maker=this.options.makeQueryResultsText:this.results_text_maker=x.makeQueryResultsText,this.queryResultsTextArea=document.createElement("p"),(0,f.addClass)(this.queryResultsTextArea,y+"_results_text")),this._val=this.element.value,this.oldQuery=this.element.value,this.options.open_on_focus&&l("focus",function(e){e.cancelBubble=!0,e.stopPropogation&&e.stopPropogation(),n.showResults()},this.element,s),l("click",function(e){e.cancelBubble=!0,e.stopPropogation&&e.stopPropogation(),n.showResults()},this.element,s),l("click",function(e){var t=(0,f.nodeOrParentMatchingSelector)(e.target,"li."+y+"_choice");if(t){var i=n.valueFromElement(t);n.selectChoiceByValue(i),n.hideResults(!1),n._val=n.element.value,n.element.focus()}},this.queryResultArea,s),l("mouseenter",function(e){var t=(0,f.nodeOrParentMatchingSelector)(e.target,"li."+y+"_choice");t&&(C(n.queryResultArea.querySelectorAll("li."+y+"_choice.active")),g(t))},this.queryResultArea,s),l("keyup",this.doQuery.bind(this),this.element,s),l("change",this.doQuery.bind(this),this.element,s),l("search",this.doQuery.bind(this),this.element,s),l("keydown",this.doSelection.bind(this),this.element,s),v.set(this.element,this)}return d(e,[{key:"doQuery",value:function(){var e=this.element.value;this._val!==e&&(this._val=e,this.oldQuery=e,e?this.insertFilteredChoiceElements(e):(this.hideResults(!1),this.selectChoiceByValue(null)))}},{key:"doSelection",value:function(e){if(27===e.which&&(this.display(),this.hideResults()),this.dropdownAreaVisible)switch(e.which){case 9:this.selectHighlightedChoice();break;case 13:e.preventDefault(),this.selectHighlightedChoice();break;case 38:e.preventDefault(),this.highlightPreviousChoice(),this.scroll();break;case 40:e.preventDefault(),this.highlightNextChoice(),this.scroll()}else switch(e.which){case 40:e.preventDefault(),this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("");break;case 9:this.revert()}}},{key:"revert",value:function(){this.dropdownAreaVisible?(this.display(),this.hideResults()):""===this.element.value&&this.selectChoiceByValue(null)}},{key:"reposition",value:function(){this.dropdownAreaVisible&&this.positionDropdownArea()}},{key:"cleanNode",value:function(e){for(;e.lastChild;)e.removeChild(e.lastChild)}},{key:"insertFilteredChoiceElements",value:function(e){var t=this,i=void 0;if(""===e)i=this.indexed_choices;else{var n=this.options.filterFn(e);i=this.indexed_choices.filter(function(e,t){var i=e.choice;return n(i,t)})}var r=i.slice(0,this.options.maxResults);if(r.length){this.defaultSelectedChoice&&i.indexOf(this.defaultSelectedChoice)>=0&&(r.indexOf(this.defaultSelectedChoice)===-1?(r.unshift(this.defaultSelectedChoice),r.pop()):(r=r.filter(function(e){return e.choice.value!==t.defaultSelectedChoice.value}),r.unshift(this.defaultSelectedChoice)));var o=this.options.formatChoice(e),s=!1,l=document.createElement("ul"),u=r.map(function(e){var i=e.choice,n=e.index,r=document.createElement("li");return r.setAttribute("class",y+"_choice"),r.setAttribute("data-immybox-value-index",n),r.innerHTML=o(i),t.selectedChoice&&n===t.selectedChoice.index&&(s=!0,g(r)),l.appendChild(r),r});!s&&g(u[0]),this.cleanNode(this.dropdownArea),this.cleanNode(this.queryResultArea),this.queryResultArea.appendChild(l),this.dropdownArea.appendChild(this.queryResultArea),this.queryResultsTextArea&&(this.queryResultsTextArea.textContent=this.results_text_maker(r.length,i.length),this.dropdownArea.appendChild(this.queryResultsTextArea))}else this.cleanNode(this.dropdownArea),this.dropdownArea.appendChild(this.noResultsArea);this._showResults()}},{key:"scroll",value:function(){this.highlightedChoice&&this.highlightedChoice.scrollIntoView({behavior:this.options.scroll_behavior})}},{key:"positionDropdownArea",value:function(){var e=(this.element.getBoundingClientRect(),2*this.element.clientHeight),t=this.element.clientWidth,i=this.queryResultArea.clientHeight,n=e+i,r=window.clientHeight+window.scrollTop;this.dropdownArea.style.width=t+"px",n>r?this.dropdownArea.style.top=i+"px":this.dropdownArea.style.top=e+"px";var o=this.dropdownArea.querySelector("."+y+"_results");o&&null!=this.scroll_position&&(o.scrollTop=this.scroll_position)}},{key:"highlightNextChoice",value:function(){var e=this.highlightedChoice;if(e){var t=e.nextSibling;t&&s(e,t)}else{var i=this.queryResultArea.querySelector("li."+y+"_choice");i&&g(i)}}},{key:"highlightPreviousChoice",value:function(){var e=this.highlightedChoice;if(e){var t=e.previousSibling;t&&s(e,t)}else{var i=this.queryResultArea.querySelector("li."+y+"_choice:last-child");i&&g(i)}}},{key:"selectHighlightedChoice",value:function(){var e=this.highlightedChoice;e?(this.selectChoiceByValue(this.valueFromElement(e)),this.hideResults(!1)):this.revert()}},{key:"display",value:function(){this.element.value=this.selectedChoice&&this.selectedChoice.choice.text||"",w(this.element,"input"),this._val=this.element.value}},{key:"selectChoiceByValue",value:function(e){var t=this.value;"undefined"==typeof e?this.selectedChoice=void 0:this.selectedChoice=this.indexed_choices.find(function(t){var i=t.choice;return i.value===e});var i=this.value;i!==t&&this.element.dispatchEvent(new CustomEvent("update",{detail:i})),this.display()}},{key:"revertOtherInstances",value:function(){var e=this;v.forEach(function(t){return t!==e&&t.revert()})}},{key:"valueFromElement",value:function(e){var t=parseInt(e.getAttribute("data-immybox-value-index"));return Number.isNaN(t)?void 0:this.values[t]}},{key:"_showResults",value:function(){!this.dropdownAreaVisible&&this.element.parentNode.appendChild(this.dropdownArea),this.dropdownAreaVisible=!0,this.scroll(),this.positionDropdownArea()}},{key:"showResults",value:function(){this.revertOtherInstances(),this.selectedChoice?this.insertFilteredChoiceElements(this.oldQuery):this.insertFilteredChoiceElements("")}},{key:"open",value:function(){return this.showResults()}},{key:"hideResults",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.dropdownAreaVisible){if(e){var t=this.dropdownArea.querySelector("."+y+"_results");if(t){var i=t.getBoundingClientRect(),n=t.querySelector("ul").getBoundingClientRect();this.scroll_position=i.y-n.y}}else this.scroll_position=null;this.element.parentNode.removeChild(this.dropdownArea),this.dropdownAreaVisible=!1}}},{key:"close",value:function(){return this.hideResults()}},{key:"getChoices",value:function(){return this.choices}},{key:"setChoices",value:function(e){this.choices=e;var t=this.options.defaultSelectedValue;return"undefined"!=typeof t&&(this.choices=[this.choices.find(function(e){var i=e.value;return i===t})].concat(r(this.choices.filter(function(e){var i=e.value;return i!==t}))).filter(function(e){return e})),this.indexed_choices=this.choices.map(function(e,t){return{choice:e,index:t}}),this.selectedChoice&&this.selectChoiceByValue(this.selectedChoice.choice.value),this.oldQuery="",this.choices}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=e}},{key:"unsetValue",value:function(){"undefined"!=typeof this.value&&(this.value=void 0)}},{key:"destroy",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=p.get(this)[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=h(n.value,2),s=o[0],l=o[1],u=!0,a=!1,c=void 0;try{for(var d,m=l[Symbol.iterator]();!(u=(d=m.next()).done);u=!0){var g=h(d.value,2),C=g[0],w=g[1];s.removeEventListener(C,w)}}catch(A){a=!0,c=A}finally{try{!u&&m["return"]&&m["return"]()}finally{if(a)throw c}}}}catch(A){t=!0,i=A}finally{try{!e&&r["return"]&&r["return"]()}finally{if(t)throw i}}(0,f.removeClass)(this.element,y),this.hideResults(),v["delete"](this.element)}},{key:"values",get:function(){return this.choices.map(function(e){return e.value})}},{key:"highlightedChoice",set:function(e){var t=this.highlightedChoice;t&&s(t,e)},get:function(){var e=this.queryResultArea.querySelector("li."+y+"_choice.active");return e||null}},{key:"value",get:function(){return this.selectedChoice&&this.selectedChoice.choice.value},set:function(e){return this.value!==e&&(this.selectChoiceByValue(e),this.oldQuery=""),this.value}}],[{key:"resetDefaults",value:function(){e.defaults=A}},{key:"pluginForElement",value:function(e){return v.get(e)}},{key:"repositionAll",value:function(){window.requestAnimationFrame(function(){v.forEach(function(e){e.dropdownAreaVisible&&e.reposition()})})}},{key:"revertAll",value:function(){v.forEach(function(e){return e.revert()})}},{key:"repositionWhenScrolling",value:function(t){t.addEventListener("scroll",e.repositionAll)}},{key:"defaults",set:function(e){Object.assign(x,e)},get:function(){return x}},{key:"pluginMethods",get:function(){return["showResults","open","hideResults","close","getChoices","setChoices","getValue","setValue","destroy"]}},{key:"all_objects",get:function(){return v}},{key:"plugin_name",get:function(){return y}}]),e}();document.addEventListener("DOMContentLoaded",function(){document.body.addEventListener("click",b.revertAll),window.addEventListener("resize",b.repositionAll)})},,function(e,t,i){var n=i(5),r=i(7),o=r(n("forEach",function(e,t){for(var i=t.length,n=0;n<i;)e(t[n]),n+=1;return t}));e.exports=o},function(e,t,i){function n(e,t){return function(){var i=arguments.length;if(0===i)return t();var n=arguments[i-1];return r(n)||"function"!=typeof n[e]?t.apply(this,arguments):n[e].apply(n,Array.prototype.slice.call(arguments,0,i-1))}}var r=i(8);e.exports=n},function(e,t,i){function n(e){return function t(i){return 0===arguments.length||r(i)?t:e.apply(this,arguments)}}var r=i(1);e.exports=n},function(e,t,i){function n(e){return function t(i,n){switch(arguments.length){case 0:return t;case 1:return o(i)?t:r(function(t){return e(i,t)});default:return o(i)&&o(n)?t:o(i)?r(function(t){return e(t,n)}):o(n)?r(function(t){return e(i,t)}):e(i,n)}}}var r=i(6),o=i(1);e.exports=n},function(e,t){e.exports=Array.isArray||function(e){return null!=e&&e.length>=0&&"[object Array]"===Object.prototype.toString.call(e)}},,function(e,t,i){e.exports=i(2)}])});